pipeline{
    agent any

    parameters {
        string(name: 'TEST_NAME', description: 'Test to run')
        choice(name: 'VERSION_TYPE', choices: ['minooor','patch', 'major'], description:'Type of version to be published')
    }

    tools{
        nodejs 'node18'
    }

    stages {
        stage('Install'){
            steps{
                sh 'npm install'
            }            
        }
        stage('Builds'){
            steps{
                sh 'npm run build'
            }            
        }
        /*stage('Test'){
            steps{
                sh 'npm run test'
            }
        }*/
        stage('Test'){
            steps{
                script{
                    if(parameters.TEST_NAME == none){
                        sh 'npm run test'
                    }else{
                        sh 'npm run test -- -t ${TEST_NAME} --verbose'
                    }
                }
                
            }
        }
        stage('Change version'){
            steps{
                sh 'npm version ${VERSION_TYPE}'
            }
        }
        stage('Publish'){
            steps{
                sh 'npm publish'
            }
        }
    }
    
}
